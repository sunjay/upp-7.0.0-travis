% Remember to use the lgrind style

\File{\1u0\1usystem\1software\1u++\-7.0.0\1src\1examples\1RWEx1.cc},{11:26},{Jul  8 2017}
\L{\LB{\C{}\1\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\-\*\-\0Mode:\0C++\0\-\*\-\0}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{\C{}\1\1\0uC++\0Version\07.0.0,\0Copyright\0(C)\0Peter\0A.\0Buhr\01994}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{\C{}\1\1\0RWEx1.cc\0\-\-\0Readers\0and\0Writer\0Problem}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{\C{}\1\1\0Author\0\0\0\0\0\0\0\0\0\0\0:\0Peter\0A.\0Buhr}}
\CE{}\L{\LB{\C{}\1\1\0Created\0On\0\0\0\0\0\0\0:\0Thu\0Aug\0\02\011:51:34\01990}}
\CE{}\L{\LB{\C{}\1\1\0Last\0Modified\0By\0:\0Peter\0A.\0Buhr}}
\CE{}\L{\LB{\C{}\1\1\0Last\0Modified\0On\0:\0Mon\0Dec\019\022:28:57\02016}}
\CE{}\L{\LB{\C{}\1\1\0Update\0Count\0\0\0\0\0:\0103}}
\CE{}\L{\LB{\C{}\1\1}}
\CE{}\L{\LB{\C{}\1\1\0This\0\0library\0is\0free\0\0software;\0you\0\0can\0redistribute\0\0it\0and\1or\0\0modify\0it}}
\CE{}\L{\LB{\C{}\1\1\0under\0the\0terms\0of\0the\0GNU\0Lesser\0General\0Public\0License\0as\0published\0by\0the}}
\CE{}\L{\LB{\C{}\1\1\0Free\0Software\0\0Foundation;\0either\0\0version\02.1\0of\0\0the\0License,\0or\0\0(at\0your}}
\CE{}\L{\LB{\C{}\1\1\0option)\0any\0later\0version.}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{\C{}\1\1\0This\0library\0is\0distributed\0in\0the\0\0hope\0that\0it\0will\0be\0useful,\0but\0WITHOUT}}
\CE{}\L{\LB{\C{}\1\1\0ANY\0\0WARRANTY;\0\0without\0even\0\0the\0\0implied\0\0warranty\0\0of\0MERCHANTABILITY\0\0or}}
\CE{}\L{\LB{\C{}\1\1\0FITNESS\0FOR\0A\0PARTICULAR\0PURPOSE.\0\0See\0the\0GNU\0Lesser\0General\0Public\0License}}
\CE{}\L{\LB{\C{}\1\1\0for\0more\0details.}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{\C{}\1\1\0You\0should\0\0have\0received\0a\0\0copy\0of\0the\0\0GNU\0Lesser\0General\0\0Public\0License}}
\CE{}\L{\LB{\C{}\1\1\0along\0\0with\0this\0library.}}
\CE{}\L{\LB{\C{}\1\1\0}}
\CE{}\L{\LB{}}
\L{\LB{\K{\#include}\0\<\V{iostream}\>}}
\L{\LB{\K{using}\0\V{std}::\V{cout};}}
\L{\LB{\K{using}\0\V{std}::\V{osacquire};}}
\L{\LB{\K{using}\0\V{std}::\V{endl};}}
\L{\LB{}}
\L{\LB{\K{\_Monitor}\0\V{ReadersWriter}\0\{}}
\L{\LB{}\Tab{4}{\K{int}\0\V{rcnt},\0\V{wcnt};}}
\L{\LB{}\Tab{4}{\V{uCondition}\0\V{RWers};}}
\L{\LB{}\Tab{4}{\K{enum}\0\V{RW}\0\{\0\V{READER},\0\V{WRITER}\0\};}}
\L{\LB{\0\0\K{public}:}}
\L{\LB{}\Tab{4}{\V{ReadersWriter}()\0:\0\V{rcnt}(0),\0\V{wcnt}(0)\0\{\}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{void}\0\V{startRead}()\0\{}}
\L{\LB{}\Tab{8}{\K{if}\0(\0\V{wcnt}\0!=0\0\|\,\|\0!\0\V{RWers}.\V{empty}()\0)\0\V{RWers}.\V{wait}(\0\V{READER}\0);}}
\L{\LB{}\Tab{8}{\V{rcnt}\0+=\01;}}
\L{\LB{}\Tab{8}{\K{if}\0(\0!\0\V{RWers}.\V{empty}()\0\&\&\0\V{RWers}.\V{front}()\0==\0\V{READER}\0)\0\V{RWers}.\V{signal}();}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0ReadersWriter::startRead}}
\CE{}\L{\LB{}}
\L{\LB{}\Tab{4}{\K{void}\0\V{endRead}()\0\{}}
\L{\LB{}\Tab{8}{\V{rcnt}\0\-=\01;}}
\L{\LB{}\Tab{8}{\K{if}\0(\0\V{rcnt}\0==\00\0)\0\V{RWers}.\V{signal}();}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0ReadersWriter::endRead}}
\CE{}\L{\LB{}}
\L{\LB{}\Tab{4}{\K{void}\0\V{startWrite}()\0\{}}
\L{\LB{}\Tab{8}{\K{if}\0(\0\V{wcnt}\0!=\00\0\|\,\|\0\V{rcnt}\0!=\00\0)\0\V{RWers}.\V{wait}(\0\V{WRITER}\0);}}
\L{\LB{}\Tab{8}{\V{wcnt}\0=\01;}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0ReadersWriter::startWrite}}
\CE{}\L{\LB{}}
\L{\LB{}\Tab{4}{\K{void}\0\V{endWrite}()\0\{}}
\L{\LB{}\Tab{8}{\V{wcnt}\0=\00;}}
\L{\LB{}\Tab{8}{\V{RWers}.\V{signal}();}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0ReadersWriter::endWrite}}
\CE{}\L{\LB{\};\0\C{}\1\1\0ReadersWriter}}
\CE{}\L{\LB{}}
\L{\LB{}}
\L{\LB{\K{volatile}\0\K{int}\0\V{SharedVar}\0=\00;}\Tab{56}{\C{}\1\1\0shared\0variable\0to\0test\0readers\0and\0writers}}
\CE{}\L{\LB{}}
\L{\LB{\K{\_Task}\0\V{Worker}\0\{}}
\L{\LB{}\Tab{4}{\V{ReadersWriter}\0\&\V{rw};}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{void}\0\V{main}()\0\{}}
\L{\LB{}\Tab{8}{\V{yield}(\0\V{rand}()\0\%\0100\0);}\Tab{56}{\C{}\1\1\0don\'t\0all\0start\0at\0the\0same\0time}}
\CE{}\L{\LB{}\Tab{8}{\K{if}\0(\0\V{rand}()\0\%\0100\0\<\070\0)\0\{}\Tab{56}{\C{}\1\1\0decide\0to\0be\0a\0reader\0or\0writer}}
\CE{}\L{\LB{}\Tab{12}{\V{rw}.\V{startRead}();}}
\L{\LB{}\Tab{12}{\V{osacquire}(\0\V{cout}\0)\0\<\<\0\S{}\"Reader:\"\SE{}\0\<\<\0\K{this}\0\<\<\0\S{}\",\0shared:\"\SE{}\0\<\<\0\V{SharedVar}\0\<\<\0\V{endl};}}
\L{\LB{}\Tab{12}{\V{yield}(\03\0);}}
\L{\LB{}\Tab{12}{\V{rw}.\V{endRead}();}}
\L{\LB{}\Tab{8}{\}\0\K{else}\0\{}}
\L{\LB{}\Tab{12}{\V{rw}.\V{startWrite}();}}
\L{\LB{}\Tab{12}{\V{SharedVar}\0+=\01;}}
\L{\LB{}\Tab{12}{\V{osacquire}(\0\V{cout}\0)\0\<\<\0\S{}\"Writer:\"\SE{}\0\<\<\0\K{this}\0\<\<\0\S{}\",\0\0wrote:\"\SE{}\0\<\<\0\V{SharedVar}\0\<\<\0\V{endl};}}
\L{\LB{}\Tab{12}{\V{yield}(\01\0);}}
\L{\LB{}\Tab{12}{\V{rw}.\V{endWrite}();}}
\L{\LB{}\Tab{8}{\}\0\C{}\1\1\0if}}
\CE{}\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0Worker::main}}
\CE{}\L{\LB{\0\0\K{public}:}}
\L{\LB{}\Tab{4}{\V{Worker}(\0\V{ReadersWriter}\0\&\V{rw}\0)\0:\0\V{rw}(\0\V{rw}\0)\0\{}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0Worker::Worker}}
\CE{}\L{\LB{\};\0\C{}\1\1\0Worker}}
\CE{}\L{\LB{}}
\L{\LB{}}
\L{\LB{\K{int}\0\V{main}()\0\{}}
\L{\LB{}\Tab{4}{\K{enum}\0\{\0\V{MaxTask}\0=\050\0\};}}
\L{\LB{}\Tab{4}{\V{ReadersWriter}\0\V{rw};}}
\L{\LB{}\Tab{4}{\V{Worker}\0\*\V{workers}[\V{MaxTask}];}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{for}\0(\0\K{int}\0\V{i}\0=\00;\0\V{i}\0\<\0\V{MaxTask};\0\V{i}\0+=\01\0)\0\{}}
\L{\LB{}\Tab{8}{\V{workers}[\V{i}]\0=\0\K{new}\0\V{Worker}(\0\V{rw}\0);}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0for}}
\CE{}\L{\LB{}\Tab{4}{\K{for}\0(\0\K{int}\0\V{i}\0=\00;\0\V{i}\0\<\0\V{MaxTask};\0\V{i}\0+=\01\0)\0\{}}
\L{\LB{}\Tab{8}{\K{delete}\0\V{workers}[\V{i}];}}
\L{\LB{}\Tab{4}{\}\0\C{}\1\1\0for}}
\CE{}\L{\LB{}}
\L{\LB{}\Tab{4}{\V{osacquire}(\0\V{cout}\0)\0\<\<\0\S{}\"successful\0completion\"\SE{}\0\<\<\0\V{endl};}}
\L{\LB{\}\0\C{}\1\1\0main}}
\CE{}\L{\LB{}}
\L{\LB{}}
\L{\LB{\C{}\1\1\0Local\0Variables:\0\1\1}}
\CE{}\L{\LB{\C{}\1\1\0tab\-width:\04\0\1\1}}
\CE{}\L{\LB{\C{}\1\1\0compile\-command:\0\"u++\0RWEx1.cc\"\0\1\1}}
\CE{}\L{\LB{\C{}\1\1\0End:\0\1\1}}
\CE{}